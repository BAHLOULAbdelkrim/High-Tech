{{ define "main" }}
  <div class="container section-list">
    <aside class="left-column">
      {{ partial "leftmenus.html" . }}
    </aside>
    <section class="content-column">
      <h1>{{ .Title }}</h1>

      {{/* ---------------- Cover image (zone supérieure qui remplace le slider) ---------------- */}}
      {{ $coverImg := "" }}
      {{ if .IsSection }}
        {{/* 1) Si on est dans un sous-menu, tenter l'image du parent (image puis menu_image) */}}
        {{ with .Parent }}
          {{ with .Params.image }}{{ $coverImg = . }}{{ end }}
          {{ if not $coverImg }}
            {{ with .Params.menu_image }}{{ $coverImg = . }}{{ end }}
          {{ end }}
        {{ end }}

        {{/* 2) Si pas d'image de parent, fallback sur image/menu_image de la section courante */}}
        {{ if not $coverImg }}
          {{ with .Params.image }}{{ $coverImg = . }}{{ end }}
          {{ if not $coverImg }}
            {{ with .Params.menu_image }}{{ $coverImg = . }}{{ end }}
          {{ end }}
        {{ end }}
      {{ end }}

      {{ if $coverImg }}
        <div class="section-cover-wrapper">
          <img class="section-cover" src="{{ $coverImg | relURL }}" alt="{{ if .Parent }}{{ .Parent.Title }}{{ else }}{{ .Title }}{{ end }}">
        </div>
      {{ end }}

      {{/* ---------------- Image au début de la page du sous-menu (affichée DANS la page) ---------------- */}}
      {{ if and .IsSection .Parent }}
        {{ $startImg := "" }}
        {{ with .Params.image }}{{ $startImg = . }}{{ end }}
        {{ if not $startImg }}
          {{ with .Params.menu_image }}{{ $startImg = . }}{{ end }}
        {{ end }}

        {{ if $startImg }}
          <div class="section-start-image">
            <img src="{{ $startImg | relURL }}" alt="{{ .Title }}">
          </div>
        {{ end }}
      {{ end }}

      <div class="submenus">
        <ul>
          {{ range .Sections }}
            <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
          {{ end }}
        </ul>
      </div>

      <div class="articles-grid">
        <!-- 1️⃣ Affiche les sous-menus -->
        {{ range .Sections }}
          <article class="card">
            <a href="{{ .RelPermalink }}">
              <h2>{{ .Title }}</h2>
              <p>{{ .Summary }}</p>
              {{ with .Params.menu_image }}
                <img src="{{ . | relURL }}" alt="{{ $.Title }}">
              {{ end }}
            </a>
          </article>
        {{ end }}
        <!-- 2️⃣ Affiche uniquement les articles normaux (pas les _index.md des sous-menus) -->
        {{ range where .Pages "Kind" "in" (slice "page") }}
          <article class="card">
            <a href="{{ .RelPermalink }}">
              <h2>{{ .Title }}</h2>
              <p>{{ .Summary }}</p>
              {{ with .Params.image }}
                <img src="{{ . | relURL }}" alt="{{ $.Title }}">
              {{ end }}
            </a>
          </article>
        {{ end }}
      </div>

      {{ if .Paginator }}
        {{ template "_internal/pagination.html" . }}
      {{ end }}
    </section>
  </div>
{{ end }}
