{{ define "main" }}
  <div class="container section-list">
    <aside class="left-column">
      {{ partial "leftmenus.html" . }}
    </aside>

    <section class="content-column">
      <h1>{{ .Title }}</h1>

      {{/* ------------------------------------------------------
           1) IMAGE DE COVER = toujours l’image du menu parent
         ------------------------------------------------------- */}}

      {{ $coverImg := "" }}

      {{ if .Parent }}

        {{/* Cas : sous-menu → cover = image du parent */}}
        {{ with .Parent.Params.image }}{{ $coverImg = . }}{{ end }}
        {{ if not $coverImg }}
          {{ with .Parent.Params.menu_image }}{{ $coverImg = . }}{{ end }}
        {{ end }}

      {{ else }}

        {{/* Cas : menu principal → cover = son image */}}
        {{ with .Params.image }}{{ $coverImg = . }}{{ end }}
        {{ if not $coverImg }}
          {{ with .Params.menu_image }}{{ $coverImg = . }}{{ end }}
        {{ end }}

      {{ end }}

      {{ if $coverImg }}
        <img class="section-cover" src="{{ $coverImg | relURL }}" alt="{{ .Title }}">
      {{ end }}


      {{/* ------------------------------------------------------
           2) IMAGE DU SOUS-MENU = uniquement en page sous-menu
         ------------------------------------------------------- */}}

      {{ if and .IsSection .Parent }}
        {{ $submenuImg := "" }}
        {{ with .Params.image }}{{ $submenuImg = . }}{{ end }}
        {{ if not $submenuImg }}
          {{ with .Params.menu_image }}{{ $submenuImg = . }}{{ end }}
        {{ end }}

        {{ if $submenuImg }}
          <img class="submenu-top-image" src="{{ $submenuImg | relURL }}" alt="{{ .Title }}">
        {{ end }}
      {{ end }}


      {{/* ------------------------------------------------------
           Sous-menus listés sous forme de liens
         ------------------------------------------------------- */}}
      <div class="submenus">
        <ul>
          {{ range .Sections }}
            <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
          {{ end }}
        </ul>
      </div>


      {{/* ------------------------------------------------------
           CARTES : sous-menus + articles
         ------------------------------------------------------- */}}
      <div class="articles-grid">

        {{/* ---- 1 : cartes des sous-menus ---- */}}
        {{ range .Sections }}
          <article class="card">
            <a href="{{ .RelPermalink }}">
              <h2>{{ .Title }}</h2>
              <p>{{ .Summary }}</p>
              {{ with .Params.menu_image }}
                <img src="{{ . | relURL }}" alt="{{ $.Title }}">
              {{ end }}
            </a>
          </article>
        {{ end }}

        {{/* ---- 2 : cartes des articles normaux ---- */}}
        {{ range where .Pages "Kind" "in" (slice "page") }}
          <article class="card">
            <a href="{{ .RelPermalink }}">
              <h2>{{ .Title }}</h2>
              <p>{{ .Summary }}</p>
              {{ with .Params.image }}
                <img src="{{ . | relURL }}" alt="{{ $.Title }}">
              {{ end }}
            </a>
          </article>
        {{ end }}

      </div>

      {{ if .Paginator }}
        {{ template "_internal/pagination.html" . }}
      {{ end }}
    </section>
  </div>
{{ end }}
